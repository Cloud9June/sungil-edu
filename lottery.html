<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì¶”ì–µì˜ ë½‘ê¸° - ìµœì¢… ì™„ì„±</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #ffeb3b;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      font-size: 2em;
      color: #d32f2f;
      margin-bottom: 20px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      max-width: 400px;
      margin: 0 auto;
      filter: blur(4px);
      pointer-events: none;
      transition: filter 0.5s;
    }
    .box {
      width: 100%;
      padding-top: 100%;
      position: relative;
      perspective: 1000px;
      cursor: pointer;
      overflow: hidden;
    }
    .flip-inner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.6s ease-in-out;
      transform-style: preserve-3d;
    }
    .flip-front, .flip-back {
      position: absolute;
      width: 100%;
      height: 100%;
      font-size: 18px;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
      font-weight: bold;
    }
    .flip-front {
      background: #0d47a1;
      color: yellow;
    }
    .flip-back {
      background: #f44336;
      color: white;
      transform: rotateY(180deg);
    }
    .flip-effect .flip-inner {
      animation: flipZoom 1.5s ease-in-out forwards;
    }
    @keyframes flipZoom {
      0% { transform: scale(1) rotateY(0deg); z-index: 100; }
      50% { transform: scale(2.5) rotateY(90deg); z-index: 1000; }
      100% { transform: scale(1) rotateY(180deg); z-index: 100; }
    }
    .flipped .flip-inner {
      transform: rotateY(180deg);
    }
    .message {
      margin-top: 20px;
      font-size: 1.2em;
      color: #2e7d32;
    }
    #startForm {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #startForm input {
      margin: 10px;
      padding: 10px;
      width: 250px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #startForm button {
      padding: 10px 20px;
      background: #4caf50;
      border: none;
      color: white;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
    }
    #congratsMessage {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1002;
      background: white;
      border: 4px solid #4caf50;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      font-size: 1.4em;
      white-space: pre-line;
    }
    #endMessage {
      display: none;
      margin-top: 30px;
      font-size: 1.6em;
      color: #b71c1c;
      font-weight: bold;
    }
    #congratsBtn {
      padding: 5px 15px;
      background-color: #4caf50;
      border-radius: 5px;
      color: #fff;
      font-size: 14px;
    }
    #finalPopup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    #finalContent {
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    #winnerList {
      margin: 20px 0;
      text-align: left;
      font-size: 2em;
      line-height: 1.6;
      max-height: 300px;
      overflow-y: auto;
    }
    #resetBtn {
      padding: 5px 10px;
      background-color: #d32f2f;
      color: white;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ì¶”ì–µì˜ ë½‘ê¸°</h1>
  <div id="grid"></div>
  <div class="message" id="message"></div>
  <div id="endMessage">ğŸ‰ ëª¨ë“  ë‹¹ì²¨ìê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤! ë½‘ê¸°ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.</div>

  <div id="startForm">
    <h2>ë½‘ê¸° ì „ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
    <input type="text" id="studentId" placeholder="í•™ë²ˆ ì…ë ¥">
    <input type="text" id="studentName" placeholder="ì´ë¦„ ì…ë ¥">
    <button onclick="startGame()">ë½‘ê¸° ì‹œì‘</button>
  </div>

  <div id="congratsMessage">
    <div id="congratsText"></div>
    <button id="congratsBtn" onclick="confirmWinner()">í™•ì¸</button>
  </div>

  <div id="finalPopup">
    <div id="finalContent">
      <h2>ğŸ‰ ëª¨ë“  ë‹¹ì²¨ìë“¤ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
      <div id="winnerList"></div>
      <button id="resetBtn" onclick="checkPassword()">ğŸ”„ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <script>
    const grid = document.getElementById('grid');
    const startForm = document.getElementById('startForm');
    const congratsBox = document.getElementById('congratsMessage');
    const congratsText = document.getElementById('congratsText');
    const endMessage = document.getElementById('endMessage');
    const finalPopup = document.getElementById('finalPopup');
    const winnerList = document.getElementById('winnerList');

    let gameStarted = false;
    let clicked = false;
    let winCount = 0;
    const MAX_WINS = 5;
    const usedStudents = new Set();
    const winningIndexes = new Set();
    const winners = [];

    while (winningIndexes.size < MAX_WINS) {
      winningIndexes.add(Math.floor(Math.random() * 100));
    }

    for (let i = 0; i < 100; i++) {
      const box = document.createElement('div');
      box.className = 'box';
      const isWinner = winningIndexes.has(i);
      box.innerHTML = `
        <div class="flip-inner">
          <div class="flip-front">â˜…${isWinner ? '' : ''}</div>
          <div class="flip-back">${isWinner ? 'ë‹¹ì²¨!!' : 'ê½!!'}</div>
        </div>`;
      box.dataset.index = i;

      box.addEventListener('click', function () {
        if (!gameStarted || clicked || winCount >= MAX_WINS || box.classList.contains('clicked')) return;
        clicked = true;

        const id = document.getElementById('studentId').value.trim();
        const name = document.getElementById('studentName').value.trim();
        const key = `${id}_${name}`;

        if (!id || !name || usedStudents.has(key)) {
          alert("í•™ë²ˆê³¼ ì´ë¦„ì´ í•„ìš”í•˜ê±°ë‚˜ ì´ë¯¸ ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.");
          clicked = false;
          return;
        }

        usedStudents.add(key);
        box.classList.add('clicked');

        if (winningIndexes.has(Number(box.dataset.index))) {
          winCount++;
          winners.push({ id, name });
          box.classList.add('flipped');
          const teacher = "ê¹€ì„ ìƒë‹˜";
          const remain = MAX_WINS - winCount;
          congratsText.innerText =
            `ğŸ‰ ì¶• ë‹¹ì²¨!! ${id} ${name} í•™ìƒ!!

í–‰ìš´ì´ ê°€ë“í•œ í•˜ë£¨!! ${teacher}ì„(ë¥¼) ì°¾ì•„ê°€ë©´ í–‰ìš´ì´ ìˆì„ ê±°ì˜ˆìš”!

ğŸ“¸ ì¸ì¦ì‚¬ì§„ì„ ì°ì–´ì„œ ê°€ì ¸ê°€ì„¸ìš”!!

âœ… ì¸ì¦ìƒ· ì°ì€ í›„ ë‹¤ìŒ í•™ìƒì€ [í™•ì¸] ë²„íŠ¼ì„ ëˆŒëŸ¬ ë½‘ê¸°ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.

ë‚¨ì€ ë‹¹ì²¨ íšŸìˆ˜: ${remain}íšŒ`;
          congratsBox.style.display = 'block';
        } else {
          box.classList.add('flip-effect');
          setTimeout(() => {
            box.classList.remove('flip-effect');
            box.classList.add('flipped');
            resetForm();
          }, 2200); // ê½ì¼ ë•Œ ì•½ê°„ ëŠ¦ê²Œ í¼ í‘œì‹œ
        }

        if (winCount === MAX_WINS) {
          setTimeout(() => {
            grid.style.filter = 'blur(6px)';
            grid.style.pointerEvents = 'none';
            endMessage.style.display = 'block';
          }, 800);
        }
      });

      grid.appendChild(box);
    }

    function startGame() {
      const id = document.getElementById('studentId').value.trim();
      const name = document.getElementById('studentName').value.trim();
      const key = `${id}_${name}`;
      if (!id || !name || usedStudents.has(key)) {
        alert("í•™ë²ˆê³¼ ì´ë¦„ì´ í•„ìš”í•˜ê±°ë‚˜ ì´ë¯¸ ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.");
        return;
      }
      gameStarted = true;
      clicked = false;
      startForm.style.display = 'none';
      grid.style.filter = 'none';
      grid.style.pointerEvents = 'auto';
    }

    function confirmWinner() {
      congratsBox.style.display = 'none';
      if (winCount < MAX_WINS) {
        resetForm();
      } else {
        // ë§ˆì§€ë§‰ ë‹¹ì²¨ìê°€ í™•ì¸ ëˆ„ë¥´ë©´ ì¶•í•˜ íŒì—… ë„ìš°ê¸°
        const listHtml = winners.map((w, i) => `${i + 1}. ${w.id} ${w.name}`).join('<br>');
        winnerList.innerHTML = listHtml;
        finalPopup.style.display = 'flex';
      }
    }

    function resetForm() {
      startForm.style.display = 'flex';
      document.getElementById('studentId').value = '';
      document.getElementById('studentName').value = '';
      gameStarted = false;
      clicked = false;
    }

    function checkPassword() {
      const pw = prompt("ì´ˆê¸°í™”ë¥¼ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if (pw === "1320") {
        location.reload();
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ì´ˆê¸°í™”ê°€ ì·¨ì†Œë©ë‹ˆë‹¤.");
      }
    }
  </script>
</body>
</html>
